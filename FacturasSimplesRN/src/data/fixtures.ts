import { Customer, CustomerDocumentType, CustomerType } from '../types/customer';
import { Invoice, InvoiceDetail, InvoiceStatus, InvoiceType } from '../types/invoice';
import { Product, ProductStatus, TaxCategory, UnitOfMeasure } from '../types/product';

export const DEFAULT_COMPANY_ID = '1';

export const seedProducts: Product[] = [
  {
    id: 'prod_001',
    productName: 'Servicio de Consultoría',
    description: 'Asesoría técnica especializada',
    unitPrice: 125.0,
    unitOfMeasure: UnitOfMeasure.HORA,
    taxCategory: TaxCategory.GRAVADO,
    taxRate: 0.13,
    status: ProductStatus.Active,
    companyId: DEFAULT_COMPANY_ID,
    isActive: true,
    createdAt: new Date('2024-01-02').toISOString(),
    updatedAt: new Date('2024-11-01').toISOString(),
  },
  {
    id: 'prod_002',
    productName: 'Licencia de Software',
    description: 'Suscripción anual plataforma SaaS',
    unitPrice: 420.0,
    unitOfMeasure: UnitOfMeasure.UNIDAD,
    taxCategory: TaxCategory.GRAVADO,
    status: ProductStatus.Active,
    companyId: DEFAULT_COMPANY_ID,
    isActive: true,
    createdAt: new Date('2024-02-10').toISOString(),
    updatedAt: new Date('2024-10-15').toISOString(),
  },
  {
    id: 'prod_003',
    productName: 'Equipo POS',
    description: 'Terminal para punto de venta',
    unitPrice: 285.5,
    unitOfMeasure: UnitOfMeasure.UNIDAD,
    taxCategory: TaxCategory.GRAVADO,
    status: ProductStatus.Active,
    companyId: DEFAULT_COMPANY_ID,
    isActive: true,
    createdAt: new Date('2024-03-05').toISOString(),
    updatedAt: new Date('2024-08-21').toISOString(),
  },
];

export const seedCustomers: Customer[] = [
  {
    id: 'cust_001',
    firstName: 'Juan Carlos',
    lastName: 'Pérez',
    businessName: 'Distribuidora Pérez S.A. de C.V.',
    nationalId: '0614-250384-101-3',
    documentType: CustomerDocumentType.NIT,
    email: 'facturacion@dpsv.com',
    phone: '+503 7123-4567',
    address: '4a Calle Poniente #123, Col. Escalón',
    city: 'San Salvador',
    department: 'San Salvador',
    departmentCode: '06',
    municipality: 'San Salvador',
    municipalityCode: '0601',
    country: 'El Salvador',
    postalCode: '01101',
    hasContributorRetention: true,
    customerType: CustomerType.Business,
    isActive: true,
    companyId: DEFAULT_COMPANY_ID,
    codActividad: '62020',
    descActividad: 'Servicios de Tecnología',
    nrc: '123456-7',
    shouldSyncToCloud: true,
    createdAt: new Date('2024-01-05').toISOString(),
    updatedAt: new Date('2024-11-18').toISOString(),
  },
  {
    id: 'cust_002',
    firstName: 'Ana María',
    lastName: 'Gómez',
    businessName: 'Consultora Integral',
    nationalId: '0521-140589-102-6',
    documentType: CustomerDocumentType.NIT,
    email: 'contacto@consultoraintegral.com',
    phone: '+503 7898-1122',
    address: 'Av. Olímpica 23, Col. San Benito',
    city: 'San Salvador',
    department: 'San Salvador',
    departmentCode: '06',
    municipality: 'San Salvador',
    municipalityCode: '0601',
    country: 'El Salvador',
    postalCode: '01101',
    hasContributorRetention: false,
    customerType: CustomerType.Business,
    isActive: true,
    companyId: DEFAULT_COMPANY_ID,
    codActividad: '70201',
    descActividad: 'Consultoría Empresarial',
    nrc: '987654-3',
    shouldSyncToCloud: true,
    createdAt: new Date('2024-02-12').toISOString(),
    updatedAt: new Date('2024-10-29').toISOString(),
  },
  {
    id: 'cust_003',
    firstName: 'Carlos',
    lastName: 'Lopez',
    businessName: 'Freelancer',
    nationalId: '0501-010199-104-2',
    documentType: CustomerDocumentType.DUI,
    email: 'carlos.lopez@email.com',
    phone: '+503 7456-3344',
    address: 'Res. Santa Elena, Calle Circunvalación',
    city: 'Antiguo Cuscatlán',
    department: 'La Libertad',
    departmentCode: '05',
    municipality: 'Antiguo Cuscatlán',
    municipalityCode: '0503',
    country: 'El Salvador',
    postalCode: '01105',
    hasContributorRetention: false,
    customerType: CustomerType.Individual,
    isActive: true,
    companyId: DEFAULT_COMPANY_ID,
    shouldSyncToCloud: false,
    createdAt: new Date('2024-03-08').toISOString(),
    updatedAt: new Date('2024-10-02').toISOString(),
  },
];

const buildInvoiceDetails = (
  invoiceId: string,
  items: Array<{ productId: string; quantity: number; overridePrice?: number }>
): InvoiceDetail[] => {
  return items.map((item, index) => {
    const product = seedProducts.find(p => p.id === item.productId);
    if (!product) {
      throw new Error(`Product with id ${item.productId} not found in seed data`);
    }

    const unitPrice = item.overridePrice ?? product.unitPrice;
    return {
      id: `${invoiceId}_detail_${index + 1}`,
      productId: product.id,
      productName: product.productName,
      quantity: item.quantity,
      unitPrice,
      obsItem: product.description ?? '',
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
      invoiceId,
    };
  });
};

export const seedInvoices: Invoice[] = [
  {
    id: 'inv_001',
    invoiceNumber: 'FAC-001-2024',
    date: new Date('2024-11-28').toISOString(),
    status: InvoiceStatus.Completada,
    customerId: 'cust_001',
    invoiceType: InvoiceType.Factura,
    documentType: '11',
    invalidatedViaApi: false,
    isHelperForCreditNote: false,
    nombEntrega: '',
    docuEntrega: '',
    observaciones: 'Servicios de consultoría mensual',
    receptor: '',
    receptorDocu: '',
    shouldSyncToCloud: true,
    companyId: DEFAULT_COMPANY_ID,
    items: buildInvoiceDetails('inv_001', [
      { productId: 'prod_001', quantity: 12 },
      { productId: 'prod_002', quantity: 1 },
    ]),
    createdAt: new Date('2024-11-28').toISOString(),
    updatedAt: new Date('2024-11-30').toISOString(),
  },
  {
    id: 'inv_002',
    invoiceNumber: 'CCF-002-2024',
    date: new Date('2024-11-25').toISOString(),
    status: InvoiceStatus.Nueva,
    customerId: 'cust_002',
    invoiceType: InvoiceType.CCF,
    documentType: '03',
    invalidatedViaApi: false,
    isHelperForCreditNote: false,
    nombEntrega: '',
    docuEntrega: '',
    observaciones: 'Implementación de plataforma SaaS',
    receptor: '',
    receptorDocu: '',
    shouldSyncToCloud: true,
    companyId: DEFAULT_COMPANY_ID,
    items: buildInvoiceDetails('inv_002', [
      { productId: 'prod_002', quantity: 1 },
      { productId: 'prod_001', quantity: 6, overridePrice: 135 },
    ]),
    createdAt: new Date('2024-11-25').toISOString(),
    updatedAt: new Date('2024-11-25').toISOString(),
  },
  {
    id: 'inv_003',
    invoiceNumber: 'FAC-003-2024',
    date: new Date('2024-10-15').toISOString(),
    status: InvoiceStatus.Completada,
    customerId: 'cust_003',
    invoiceType: InvoiceType.Factura,
    documentType: '11',
    invalidatedViaApi: false,
    isHelperForCreditNote: false,
    nombEntrega: 'Luis Hernández',
    docuEntrega: '0614-220190-102-4',
    observaciones: 'Entrega de equipos POS',
    receptor: 'Carlos Lopez',
    receptorDocu: '0501-010199-104-2',
    shouldSyncToCloud: false,
    companyId: DEFAULT_COMPANY_ID,
    items: buildInvoiceDetails('inv_003', [
      { productId: 'prod_003', quantity: 3 },
    ]),
    createdAt: new Date('2024-10-15').toISOString(),
    updatedAt: new Date('2024-10-20').toISOString(),
  },
];
